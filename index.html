<!DOCTYPE html>
<html>
<head>
    <title>Find the Accessory/ Core item</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #fff8f0; color: #333; }
        h1 { color: black; }
        label { font-weight: bold; }
        .error { color: red; }
        .refreshed { color: green; }
        .container { display: flex; }
        .left-panel { width: 40%; padding-right: 20px; border-right: 2px solid #ccc; }
        .right-panel { width: 60%; padding-left: 20px; }
        select, input[type="text"] { width: 300px; padding: 5px; margin: 5px 0; }
        .button { background-color: #E97400; color: white; padding: 8px 12px; border: none; cursor: pointer; margin-right: 10px; }
        .button:hover { background-color: #cc5f00; }
        .reset-btn { background-color: grey; color: white; padding: 8px 12px; border: none; cursor: pointer; }
        .reset-btn:hover { background-color: #666; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid white; padding: 8px; text-align: left; }
        th { background-color: #E97400; color: white; }
    </style>
</head>
<body>
    <h1>Find the Accessory/ Core item</h1>
    <div class="container">
        <div class="left-panel">
            <form method="post">
                <p>Please select the core item/ accessory</p>
                <label>Type:</label><br>
                <select name="type" onchange="this.form.submit()">
                    <option value="">--Select Type--</option>
                    {% for t in types %}
                        <option value="{{ t }}" {% if t == selected_type %}selected{% endif %}>{{ "Accessory" if t == "A" else "Core Item" }}</option>
                    {% endfor %}
                </select><br>

                <label>Category:</label><br>
                <select name="department" onchange="this.form.submit()">
                    <option value="">--Select Category--</option>
                    {% for d in departments %}
                        <option value="{{ d }}" {% if d == selected_department %}selected{% endif %}>{{ d }}</option>
                    {% endfor %}
                </select><br>

                <label>Brand:</label><br>
                <select name="brand" onchange="this.form.submit()">
                    <option value="">--Select Brand--</option>
                    {% for b in brands %}
                        <option value="{{ b }}" {% if b == selected_brand %}selected{% endif %}>{{ b }}</option>
                    {% endfor %}
                </select><br>

                <label>Item Name:</label><br>
                <select name="item_name">
                    <option value="">--Select Item Name--</option>
                    {% for name in item_names %}
                        <option value="{{ name }}" {% if name == selected_item_name %}selected{% endif %}>{{ name }}</option>
                    {% endfor %}
                </select><br>

                <button class="button" name="action" value="search_dropdown">Search</button>
                <button class="reset-btn" name="action" value="reset_dropdown">Reset</button>
                {% if refreshed and action == "reset_dropdown" %}
                    <p class="refreshed">Refreshed</p>
                {% endif %}
                {% if error and action == "search_dropdown" %}
                    <p class="error">{{ error }}</p>
                {% endif %}

                <hr>
                <p>OR please paste the product link</p>
                <input type="text" name="product_link" value="{{ product_link }}" placeholder="Full Product Link"><br>
                <button class="button" name="action" value="search_link">Search</button>
                <button class="reset-btn" name="action" value="reset_link">Reset</button>
                {% if refreshed and action == "reset_link" %}
                    <p class="refreshed">Refreshed</p>
                {% endif %}
                {% if error and action == "search_link" %}
                    <p class="error">{{ error }}</p>
                {% endif %}

                <hr>
                <p>OR please enter the product number</p>
                <input type="text" name="product_number" value="{{ product_number }}" placeholder="Product Number (8 digits)"><br>
                <button class="button" name="action" value="search_number">Search</button>
                <button class="reset-btn" name="action" value="reset_number">Reset</button>
                {% if refreshed and action == "reset_number" %}
                    <p class="refreshed">Refreshed</p>
                {% endif %}
                {% if error and action == "search_number" %}
                    <p class="error">{{ error }}</p>
                {% endif %}
            </form>
        </div>
        <div class="right-panel">
            {% if result %}
                <h2>You are searching: {{ result.Brand }} {{ result["Item Name"] }} ({{ result.Type }})</h2>
                <h3>
                    {% if result["Item Type"] == "C" %}
                        Related Accessories
                    {% else %}
                        Related Core Items
                    {% endif %}
                </h3>
                <table>
                    <tr><th>Category</th><th>Brand</th><th>Item Name</th><th>RRP</th><th>Product Link</th></tr>
                    {% for item in related_items %}
                        <tr>
                            <td>{{ item["Department"] }}</td>
                            <td>{{ item["Brand"] }}</td>
                            <td>{{ item["Item Name"] }}</td>
                            <td>HK${{ item["RRP"] | int }}</td>
                            <td><a href="https://fortress.com.hk/p/{{ item['Item'] }}" target="_blank">view</a></td>
                        </tr>
                    {% endfor %}
                </table>
            {% endif %}
        </div>
    </div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const form = document.querySelector("form");
  if (form) {
    form.addEventListener("submit", function(e) {
      e.preventDefault();
      
fetch("https://core-accessory-tool-production.up.railway.app/", {
  method: "POST",
  body: new FormData(this)
})

      .then(response => response.text())
      .then(html => {
        document.body.innerHTML = html;
      })
      .catch(error => {
        console.error("Error:", error);
        alert("Something went wrong. Please try again.");
      });
    });
  }
});
</script>

</body>
</html>
